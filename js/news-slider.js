// –ü—Ä–æ—Å—Ç–æ–π —Å–ª–∞–π–¥–µ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 3 –Ω–æ–≤–æ—Å—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å drag —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
let currentSlideGroup = 0;
let newsInterval;
let isPaused = false;
let isDragging = false;
let startX = 0;
let currentX = 0;
let dragThreshold = 50; // –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å–ª–∞–π–¥–∞
const slidesPerGroup = 3; // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 3 –Ω–æ–≤–æ—Å—Ç–∏ —Å—Ä–∞–∑—É
let newsData = []; // –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–µ–π

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
async function loadNewsData() {
    try {
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage (–∞–¥–º–∏–Ω–∫–∞)
        const savedData = localStorage.getItem('newsData');
        if (savedData) {
            newsData = JSON.parse(savedData);
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ –∞–¥–º–∏–Ω–∫–∏:', newsData);
            return;
        }
        
        // –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ JSON —Ñ–∞–π–ª–∞
        const response = await fetch('data/news.json');
        if (response.ok) {
            newsData = await response.json();
            console.log('–ó–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON:', newsData);
        } else {
            throw new Error('–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π:', error);
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        newsData = getDefaultNewsData();
    }
}

// –î–∞–Ω–Ω—ã–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
function getDefaultNewsData() {
    return [
        {
            id: 1,
            title: "–û—Ç–∫—Ä—ã–ª–æ—Å—å –Ω–æ–≤–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∏–∏",
            description: "–° —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º –∏ –æ–ø—ã—Ç–Ω—ã–º–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏",
            badge: "üÜï –ù–æ–≤–æ—Å—Ç—å",
            date: "15 –≤–µ—Ä–µ—Å–Ω—è 2024",
            image: "https://images.unsplash.com/photo-1576091160399-112ba8d25d1f?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
        },
        {
            id: 2,
            title: "–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω—ñ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó",
            description: "–ö–æ–∂–Ω–æ–≥–æ –≤—ñ–≤—Ç–æ—Ä–∫–∞ –∑ 9:00 –¥–æ 12:00 –¥–ª—è –ø–µ–Ω—Å—ñ–æ–Ω–µ—Ä—ñ–≤",
            badge: "üìÖ –ê–∫—Ü—ñ—è",
            date: "10 –≤–µ—Ä–µ—Å–Ω—è 2024",
            image: "https://images.unsplash.com/photo-1559757175-0eb30cd8c063?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
        },
        {
            id: 3,
            title: "–ù–æ–≤—ñ –≤–∏–¥–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∏—Ö –∞–Ω–∞–ª—ñ–∑—ñ–≤",
            description: "–†–æ–∑—à–∏—Ä–∏–ª–∏ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å",
            badge: "üî¨ –ü–æ—Å–ª—É–≥–∞",
            date: "8 –≤–µ—Ä–µ—Å–Ω—è 2024",
            image: "https://images.unsplash.com/photo-1582750433449-648ed127bb54?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
        },
        {
            id: 4,
            title: "–û—Ç—Ä–∏–º–∞–ª–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç —è–∫–æ—Å—Ç—ñ ISO 9001",
            description: "–ú—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∞ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Å–∏—Å—Ç–µ–º–∏ –º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç—É",
            badge: "üèÜ –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è",
            date: "5 –≤–µ—Ä–µ—Å–Ω—è 2024",
            image: "https://images.unsplash.com/photo-1559757148-5c350d0d3c56?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
        },
        {
            id: 5,
            title: "–ù–æ–≤–∏–π —Å–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç –∑ –Ω–µ–≤—Ä–æ–ª–æ–≥—ñ—ó",
            description: "–î–æ–∫—Ç–æ—Ä –ü–µ—Ç—Ä–µ–Ω–∫–æ –û–ª–µ–∫—Å—ñ–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á",
            badge: "üë®‚Äç‚öïÔ∏è –õ—ñ–∫–∞—Ä",
            date: "1 –≤–µ—Ä–µ—Å–Ω—è 2024",
            image: "https://images.unsplash.com/photo-1612349317150-e413f6a5b16d?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
        },
        {
            id: 6,
            title: "–ü–æ–º–æ–≥–ª–∏ –±–æ–ª–µ–µ 5000 –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤",
            description: "–í —ç—Ç–æ–º –≥–æ–¥—É –Ω–∞—à–∞ –∫–ª–∏–Ω–∏–∫–∞ –æ–∫–∞–∑–∞–ª–∞ –ø–æ–º–æ—â—å —Ä–µ–∫–æ—Ä–¥–Ω–æ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤",
            badge: "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
            date: "28 —Å–µ—Ä–ø–Ω—è 2024",
            image: "https://images.unsplash.com/photo-1584515933487-779824d29309?ixlib=rb-4.0.3&auto=format&fit=crop&w=400&q=80"
        }
    ];
}

// –°–æ–∑–¥–∞–Ω–∏–µ HTML –¥–ª—è —Å–ª–∞–π–¥–æ–≤
function createNewsSlides() {
    const container = document.getElementById('newsContainer');
    if (!container) {
        console.error('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–æ–≤–æ—Å—Ç–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
    container.innerHTML = '';
    
    // –°–æ–∑–¥–∞–µ–º —Å–ª–∞–π–¥—ã –∏–∑ –¥–∞–Ω–Ω—ã—Ö
    newsData.forEach((news, index) => {
        const slide = document.createElement('div');
        slide.className = 'news-slide';
        slide.innerHTML = `
            <div class="news-content">
                <div class="news-image" style="background-image: url('${news.image}')"></div>
                <div class="news-text">
                    <span class="news-badge">${news.badge}</span>
                    <h3>${news.title}</h3>
                    <p>${news.description}</p>
                </div>
            </div>
        `;
        container.appendChild(slide);
    });
    
    console.log(`–°–æ–∑–¥–∞–Ω–æ ${newsData.length} —Å–ª–∞–π–¥–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π`);
}

async function initNewsSlider() {
    console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–∞–π–¥–µ—Ä–∞ –Ω–æ–≤–æ—Å—Ç–µ–π - 3 –Ω–æ–≤–æ—Å—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–µ–π
    await loadNewsData();
    
    // –°–æ–∑–¥–∞–µ–º —Å–ª–∞–π–¥—ã –∏–∑ –¥–∞–Ω–Ω—ã—Ö
    createNewsSlides();
    
    const container = document.getElementById('newsContainer');
    const slides = document.querySelectorAll('.news-slide');
    const slider = document.querySelector('.news-slider');
    
    console.log('–ù–∞–π–¥–µ–Ω–æ —Å–ª–∞–π–¥–æ–≤:', slides.length);
    console.log('–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞–π–¥–µ–Ω:', !!container);
    
    if (!container || slides.length === 0) {
        console.error('–ù–µ –Ω–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–ª–∏ —Å–ª–∞–π–¥—ã');
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 —Å–ª–∞–π–¥–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    showSlideGroup(0);
    
    const totalGroups = Math.ceil(slides.length / slidesPerGroup);
    console.log('–í—Å–µ–≥–æ –≥—Ä—É–ø–ø –ø–æ 3 —Å–ª–∞–π–¥–∞:', totalGroups);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø
    if (totalGroups > 1) {
        startAutoSlide();
    }
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–µ–¥–µ–Ω–∏–µ–º –º—ã—à–∏
    if (slider) {
        slider.addEventListener('mouseenter', () => {
            isPaused = true;
            console.log('–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
        });
        slider.addEventListener('mouseleave', () => {
            if (!isDragging) {
                isPaused = false;
                console.log('–ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∞');
            }
        });
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º drag —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
    if (slider && totalGroups > 1) {
        setupDragFunctionality(slider);
    }
    
    console.log('–°–ª–∞–π–¥–µ—Ä —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω - 3 –Ω–æ–≤–æ—Å—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ');
}

function showSlideGroup(groupIndex) {
    console.log('–ü–æ–∫–∞–∑ –≥—Ä—É–ø–ø—ã —Å–ª–∞–π–¥–æ–≤:', groupIndex);
    
    const slides = document.querySelectorAll('.news-slide');
    
    if (slides.length === 0) {
        console.error('–ù–µ—Ç —Å–ª–∞–π–¥–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
        return;
    }
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –ø–µ—Ä–≤—ã–µ 3 —Å–ª–∞–π–¥–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    slides.forEach((slide, index) => {
        slide.classList.remove('active');
        if (index < 3) {
            slide.classList.add('active');
            slide.style.display = 'flex';
        } else {
            slide.style.display = 'none';
        }
    });
    
    console.log('–ü–æ–∫–∞–∑–∞–Ω—ã –ø–µ—Ä–≤—ã–µ 3 –Ω–æ–≤–æ—Å—Ç–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ');
}

function setupDragFunctionality(slider) {
    // Mouse events
    slider.addEventListener('mousedown', handleDragStart);
    slider.addEventListener('mousemove', handleDragMove);
    slider.addEventListener('mouseup', handleDragEnd);
    slider.addEventListener('mouseleave', handleDragEnd);
    
    // Touch events –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    slider.addEventListener('touchstart', handleDragStart, { passive: false });
    slider.addEventListener('touchmove', handleDragMove, { passive: false });
    slider.addEventListener('touchend', handleDragEnd);
    
    // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
    slider.addEventListener('selectstart', (e) => e.preventDefault());
    slider.addEventListener('dragstart', (e) => e.preventDefault());
    
    console.log('Drag —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
}

function handleDragStart(e) {
    e.preventDefault();
    isDragging = true;
    isPaused = true;
    
    const clientX = e.type === 'mousedown' ? e.clientX : e.touches[0].clientX;
    startX = clientX;
    currentX = clientX;
    
    document.body.style.cursor = 'grabbing';
    console.log('–ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è');
}

function handleDragMove(e) {
    if (!isDragging) return;
    
    e.preventDefault();
    const clientX = e.type === 'mousemove' ? e.clientX : e.touches[0].clientX;
    currentX = clientX;
    
    const deltaX = currentX - startX;
    const container = document.getElementById('newsContainer');
    
    // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
    if (container) {
        const opacity = Math.max(0.7, 1 - Math.abs(deltaX) / 200);
        container.style.opacity = opacity;
        
        // –ù–µ–±–æ–ª—å—à–æ–π —Å–¥–≤–∏–≥ –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
        const translateX = deltaX * 0.1; // —É–º–µ–Ω—å—à–∞–µ–º —Å–¥–≤–∏–≥ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
        container.style.transform = `translateX(${translateX}px)`;
    }
}

function handleDragEnd(e) {
    if (!isDragging) return;
    
    isDragging = false;
    document.body.style.cursor = '';
    
    const deltaX = currentX - startX;
    const container = document.getElementById('newsContainer');
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∏–ª–∏
    if (container) {
        container.style.opacity = '1';
        container.style.transform = 'translateX(0)';
    }
    
    console.log('–û–∫–æ–Ω—á–∞–Ω–∏–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è, —Å–º–µ—â–µ–Ω–∏–µ:', deltaX);
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –≥—Ä—É–ø–ø—É —Å–ª–∞–π–¥–æ–≤ –µ—Å–ª–∏ —Å–º–µ—â–µ–Ω–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–æ–ª—å—à–æ–µ
    if (Math.abs(deltaX) > dragThreshold) {
        if (deltaX > 0) {
            // –ü–µ—Ä–µ—Ç–∞—â–∏–ª–∏ –≤–ø—Ä–∞–≤–æ - –ø—Ä–µ–¥—ã–¥—É—â–∞—è –≥—Ä—É–ø–ø–∞
            prevSlideGroup();
            console.log('–ü–µ—Ä–µ—Ç–∞—â–∏–ª–∏ –≤–ø—Ä–∞–≤–æ - –ø—Ä–µ–¥—ã–¥—É—â–∞—è –≥—Ä—É–ø–ø–∞');
        } else {
            // –ü–µ—Ä–µ—Ç–∞—â–∏–ª–∏ –≤–ª–µ–≤–æ - —Å–ª–µ–¥—É—é—â–∞—è –≥—Ä—É–ø–ø–∞
            nextSlideGroup();
            console.log('–ü–µ—Ä–µ—Ç–∞—â–∏–ª–∏ –≤–ª–µ–≤–æ - —Å–ª–µ–¥—É—é—â–∞—è –≥—Ä—É–ø–ø–∞');
        }
    }
    
    // –í–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫—É —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
    setTimeout(() => {
        if (!document.querySelector('.news-slider:hover')) {
            isPaused = false;
        }
    }, 500);
}

function nextSlideGroup() {
    const slides = document.querySelectorAll('.news-slide');
    const totalGroups = Math.ceil(slides.length / slidesPerGroup);
    const nextIndex = (currentSlideGroup + 1) % totalGroups;
    console.log('–°–ª–µ–¥—É—é—â–∞—è –≥—Ä—É–ø–ø–∞:', nextIndex);
    showSlideGroup(nextIndex);
}

function prevSlideGroup() {
    const slides = document.querySelectorAll('.news-slide');
    const totalGroups = Math.ceil(slides.length / slidesPerGroup);
    const prevIndex = (currentSlideGroup - 1 + totalGroups) % totalGroups;
    console.log('–ü—Ä–µ–¥—ã–¥—É—â–∞—è –≥—Ä—É–ø–ø–∞:', prevIndex);
    showSlideGroup(prevIndex);
}

function startAutoSlide() {
    console.log('–ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –≥—Ä—É–ø–ø');
    
    newsInterval = setInterval(() => {
        if (!isPaused && !isDragging) {
            console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–π –≥—Ä—É–ø–ø–µ');
            nextSlideGroup();
        }
    }, 8000);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫ —Å–ª–∞–π–¥–µ—Ä–∞');
    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã CSS —É—Å–ø–µ–ª –ø—Ä–∏–º–µ–Ω–∏—Ç—å—Å—è
    setTimeout(() => {
        initNewsSlider();
    }, 100);
});